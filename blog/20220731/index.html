<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<title>自制网页js音乐播放器 ~ 博客 ~ 木辛木杉</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/bfq.css">
		<link rel="stylesheet" href="/css/github-dark.min.css">
		<script src="/js/jquery-3.6.0.min.js"></script>
		<script src="/js/jquery.pjax.js"></script>
		<script src="/js/highlight.min.js"></script>
		<script>hljs.highlightAll();</script>
		<script>
			$(document).pjax('a[date-pjax]', '#main-content', {fragment: '#main-content', timeout: '10000'});
			$(document).on('ready pjax:end', function(event) {
				var bbb = $('#bbb');
				var ccc = $('#ccc');
				var slider = $('#slider');
				bbb.click(function(){
					slider.animate({right:0},500);
					bbb.attr("class","gb");
					ccc.attr("class","dk");
				});
				ccc.click(function(){
					slider.animate({right:-350},500);
					ccc.attr("class","gb");
					bbb.attr("class","dk");
				});
			});
		</script>
	</head>
	<body bgcolor="#97a791">
		<div id="main-content">
			<div class="divm">
				<h2>自制网页js音乐播放器</h2>
				<p class="date">2022.07.31 13:23</p>
				<br>
				<p>虽然说是自制，其实也是网上查了很多，东拼西凑的</p>
				<p>首先，该播放器就是左下角的那个，支持顺序播放，随机播放，上一首下一首，调节音量，在Chrome的MediaSession媒体控件中显示专辑图等</p>
				<p>我是直接用的网易云的音乐和专辑图，你也可以修改成其他网站的音乐和图片</p>
				<p>svg图全是去<a class="lianJie" target="_blank" href="//www.iconfont.cn/">阿里的图标库</a>里找的，你也可以换成其他的</p>
				<p>需要引用<a class="lianJie" target="_blank" href="//jquery.com/">jQuery</a></p>
				<p>下面是Demo和代码：</p>
				<a class="lianJie" target="_blank" href="./demo.html">Demo</a>
				<p>直接引用下面三个就好了：</p>
				<ul>
					<a class="lianJie" target="_blank" href="//github.com/1210718010/1210718010.github.io/blob/master/css/bfq.css">bfq.css</a>
					<br>
					<a class="lianJie" target="_blank" href="//github.com/1210718010/1210718010.github.io/blob/master/js/bfq.js">bfq.js</a>
					<br>
					<a class="lianJie" target="_blank" href="//github.com/1210718010/1210718010.github.io/blob/master/js/jquery-3.6.0.min.js">jquery-3.6.0.min.js</a>
				</ul>
				<pre><code class="language-html">
&ltlink rel="stylesheet" href="https://muxmus.com/css/bfq.css"&gt
&ltscript src="https://muxmus.com/js/jquery-3.6.0.min.js"&gt&lt/script&gt
&ltscript src="https://muxmus.com/js/bfq.js"&gt&lt/script&gt
				</code></pre>
				<p class="zhuShi">ps：bfq.js文件可能需要引用在末尾，也就是&lt/body&gt的前面。</p>
				<p>下面是带注释讲解的js代码</p>
				<pre><code class="language-js">
// JavaScript Document
//如果要引用到别的网站，需要下载我的svg，或者修改svg的地址在前面加上“https://muxmus.com”
document.write("&ltdiv id=\"bfq\" class=\"divb\"&gt");
document.write("	&ltimg id=\"up\" class=\"up1\" alt=\"\" src=\"/img/up.svg\" /&gt");
document.write("	&ltimg id=\"down\" class=\"down1\" alt=\"\" src=\"/img/down.svg\" /&gt");
document.write("	&lta id=\"audio\"&gt&ltimg id=\"stop\" alt=\"\" src=\"/img/zt.svg\" /&gt&lt/a&gt");
document.write("	&ltdiv class=\"divn\"&gt");
document.write("		&ltimg id=\"next\" class=\"next1\" alt=\"\" src=\"/img/next.svg\" /&gt");
document.write("	&lt/div&gt");
document.write("	&ltaudio id=\"music\" preload=\"auto\">&lt/audio&gt");
document.write("&lt/div>");
document.write("&ltdiv class=\"divs\">");
document.write("	&ltp id=\"songs\" class=\"song1\">&lt/p>");
document.write("&lt/div>");
var url = "//music.163.com/song/media/outer/url?id=";
var musicId = [
	"29836459",
	"460508",
	"730631",
	//这里放网易云音乐的id，例如这是一首歌的网址“https://music.163.com/#/song?id=29836459”，id就是最后那一串数“29836459”
	//可无限添加，需用逗号隔开，需与下面的歌曲名歌手名专辑图链接一一对应
];
var title = [
	"ハルヒの想い",
	"「プラチナむかつく」",
	"歳月-雲流れ-",
	//这里放歌曲名
];
var artist = [
	"神前暁",
	"神前暁",
	"Foxtail-Grass Studio",
	//这里放歌手名
];
var album = [
	"YcMoW1Y4UKLJXLbF8SCdww==/3247957351157955",
	"X0Jdt5C1MLbZjLTb2lZzsw==/109951165561011067",
	"tJl-San_dLNzomvAT77KJg==/853221023197375",
	//这里放网易云的专辑图链接，用F12找到专辑图的链接
	//例如“http://p1.music.126.net/YcMoW1Y4UKLJXLbF8SCdww==/3247957351157955.jpg?param=130y130”，只取中间的“YcMoW1Y4UKLJXLbF8SCdww==/3247957351157955”就行了
];
var count = musicId.length - 1;
var original = new Array;
var i = 0;
var num = 0;
for (var j = 0; j <= count; j++){
	original[j] = j;
}
original.sort(function(){
	return 0.5 - Math.random();
});
//这里生成了随机数列，如果要顺序播放，可以删掉上面三行
$(function(){
	$("#audio").click(function(){
		if(music.paused){
			music.play();
			$("#stop").attr("src", "/img/bf.svg");
		}else{
			music.pause();
			$("#stop").attr("src", "/img/zt.svg");
		}
	});
});
function musicClick(){
	musicPlay();
	music.onended = function(){
		nextSong();
		music.play();
	}
	$("#last").click(function(){
		lastSong();
		if(music.paused){
			$("#stop").attr("src", "/img/bf.svg");
		}
		music.play();
	});
	$("#next").click(function(){
		nextSong();
		if(music.paused){
			$("#stop").attr("src", "/img/bf.svg");
		}
		music.play();
	});
}
function lastSong(){
	i -= 1;
	if(i < 0){
		num = original[0];
		original.sort(function(){
			return 0.5 - Math.random();
		});
		ifLast();
		i = count;
	}
	musicPlay();
}
function nextSong(){
	i += 1;
	if(i > count){
		num = original[count];
		original.sort(function(){
			return 0.5 - Math.random();
		});
		ifNext();
		i = 0;
	}
	musicPlay();
}
function ifLast(){
	if(original[count] == num){
		original.sort(function(){
			return 0.5 - Math.random();
		});
		ifLast();
	}
}
function ifNext(){
	if(original[0] == num){
		original.sort(function(){
			return 0.5 - Math.random();
		});
		ifNext();
	}
}
function musicPlay(){
	music.src = url + musicId[original[i]] + ".mp3";
	//如果你要使用其他网站的音乐，需要调整这里和前面的musicId数组
	document.getElementById("songs").innerHTML = title[original[i]] + " · " + artist[original[i]];
	//这里输出显示在右下角的歌曲名和歌手名，可自行调整样式
	media();
}
function media(){
    if ('mediaSession' in navigator){
		navigator.mediaSession.metadata = new MediaMetadata({
			title: title[original[i]],
			artist: artist[original[i]],
			artwork: [{src: "//p1.music.126.net/" + album[original[i]] + ".jpg?param=300y300" }],
			//这里的“300y300”可以调整缩略图的分辨率，如果太大可能加载过慢
			//如果你要使用其他网站的图片，需要调整这里和前面的album数组
		});
		navigator.mediaSession.setActionHandler('play', function(){
			music.play();
			$("#stop").attr("src", "/img/bf.svg");
		});
		navigator.mediaSession.setActionHandler('pause', function(){
			music.pause();
			$("#stop").attr("src", "/img/zt.svg");
		});
		navigator.mediaSession.setActionHandler('nexttrack', function(){
			nextSong();
			if(music.paused){
				$("#stop").attr("src", "/img/bf.svg");
			}
			music.play();
		});
		navigator.mediaSession.setActionHandler('previoustrack', function(){
			lastSong();
			if(music.paused){
				$("#stop").attr("src", "/img/bf.svg");
			}
			music.play();
		});
    }
}
if(document.all){
	window.attachEvent('onload',musicClick);
}
else{
	window.addEventListener('load',musicClick,false);
}
$(document).ready(function(){
	$('#stop').on('mouseenter',function(){
		$('#songs').attr("class", "song2");
		$('#up').attr("class", "up2");
		$('#down').attr("class", "down2");
		$('#next').attr("class", "next2");
	});
	$('#bfq').on('mouseleave',function(){
		$('#songs').attr("class", "song1");
		$('#up').attr("class", "up1");
		$('#down').attr("class", "down1");
		$('#next').attr("class", "next1");
	});
});
$(function(){
	var vol = 0.3;
	//这里是载入是的默认音量，可以从0到1任意调节
	$('#music')[0].volume = vol;
	$('#up').click(function(){
		vol = vol<1?(vol*10+1)/10:1;
		$('#music')[0].volume = vol;
	});
	$('#down').click(function(){
		vol = vol>0?(vol*10-1)/10:0;
		$('#music')[0].volume = vol;
	});
});
				</code></pre>
			</div>
			<div id="slider">
				<img class="tx" src="/img/bk_8.png" alt="" />
				<div class="js">
					<br>
					<p><a date-pjax href="/blog/">返回目录</a></p>
					<br>
					<p>自制网页js音乐播放器</p>
					<p><a date-pjax href="/blog/20220727-2/">天台山</a></p>
					<p><a date-pjax href="/blog/20220727/">中华大扁锹饲养日志</a></p>
				</div>
			</div>
			<div class="dk" id="bbb">
				<img class="cd" alt="" src="/img/cd.svg" />
			</div>
			<div class="gb" id="ccc">
				<img class="cd" alt="" src="/img/gb.svg" />
			</div>
			<script src="/js/cbl.js"></script>
			<script src="/js/link.js"></script>
		</div>
		<script src="/js/bfq.js"></script>
	</body>
</html>
